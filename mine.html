<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>MineSleeper</title>

        <link rel="stylesheet" href="https://abstractn.github.io/repo/abs.css">
        <script src="https://abstractn.github.io/repo/jquery3.js"></script>

        <script src="https://unpkg.com/feather-icons"></script>

        <style>
            :root
            {
                --cell-size:15px;
                --cell-margin:1px;
                --cell-col1:#ccc; /* eee */
                --cell-col2:#eee; /* ccc */
                /* 75c - 70c */
            }

            /* ############################################################# */

            .feather
            {
                width:12px;
            }

            .cell
            {
                width:var(--cell-size);
                height:var(--cell-size);
            }

            .cell-close
            {
                background-color:var(--cell-col1);
                border-color:var(--cell-col2);
                border-width:calc( var(--cell-size) - var(--cell-size) / 1.5 );
                /* border-width:calc( var(--cell-size) - calc( var(--cell-size) / 1.5 ) ); */
                border-style:outset;
            }
            .cell-open
            {
                background-color:var(--cell-col1);
                border-color:transparent;
                border-width:calc( var(--cell-size) - var(--cell-size) / 1.5 );
                border-style:outset;
            }

            #field
            {
                border-spacing:var(--cell-margin);
                background-color:darkgray;
                font-size:12px;
                cursor:crosshair;
                /**/color:red;
            }
        </style>
    </head>
    <body class="flex center">
        <main class="flex center extend">
            <table id="field">
                <!-- <tr>
                    <th class="cell cell-close"></th>
                    <th class="cell cell-close"></th>
                </tr>
                <tr>
                    <th class="cell cell-close"></th>
                    <th class="cell cell-close"></th>
                </tr> -->
            </table>
            <!-- <i data-feather="flag"></i>
            <i data-feather="zap"></i> -->
        </main>

        <script>feather.replace();</script>

        <script>
            const _F_DEBUG = true;
            function log(o){if(_F_DEBUG){console.log(o);}}
            function randomInt(min,max){return Math.floor((Math.random()*(max-min))+min);}

            // #################################################################
            var field = document.getElementById("field");
            var sizeX=5;
            var sizeY=sizeX;
            var matrix = new Array(sizeX);
            for(let i=0; i<matrix.length; i++)
            { matrix[i] = new Array(sizeY); }


            var colors={
                "1":"blue",
                "2":"green",
                "3":"red",
                "4":"darkblue",
                "5":"darkred",
                "6":"darkcyan",
                "7":"purple",
                "8":"black"
            };

            function generateMines(quantity)
            {
                let q = quantity || Math.floor( ((sizeX+sizeY)/2)*1.5 );
                // let targetedCell="";
                let randX="";
                let randY="";

                do
                {
                    // targetedCell = document.getElementById( randomInt(0,sizeX) + "-" + randomInt(0,sizeY) );
                    randX = randomInt(0,sizeX);
                    randY = randomInt(0,sizeY);

                    if(matrix[randX][randY] == "X")
                    {
                        continue;
                    }
                    else
                    {
                        matrix[randX][randY] = "X";
                        q--;
                    }

                    /* if( targetedCell.innerHTML == "X" )
                    {
                        continue;
                    }
                    else
                    {
                        log(" >X@"+targetedCell.id);
                        targetedCell.innerHTML = "X";
                        q--;
                    } */
                }
                while(q > 0);
                log("generateMines()>end");
            }

            function generateCounters()
            {
                // cycle through each cell
                    // check its 3x3 surroundings
                    // count 'X's for mines
                    // print counted mines
                    // reset counter
            }

            function drawMinefield(sizeX,sizeY)
            {
                let res="";
                for(var x=0; x<sizeX; x++)
                {
                    res += '<tr>';
                    for(var y=0; y<sizeY; y++)
                    {
                        res += '<th id="'+x+'-'+y+'" class="cell cell-close"></th>';
                    }
                    res += '</tr>';
                }
                return res;
            }

            field.innerHTML = drawMinefield(sizeX,sizeY);
            generateMines();
            generateCounters();
            var cells = document.getElementsByClassName("cell");
            for(let i=0; i<cells.length; i++)
            {
                cells[i].addEventListener("click", game);
            }

            function game(event)
            {
                openCell(event.target.id);
            }

            function openCell(cellID)
            {
                let cellX = cellID.charAt(0);
                let cellY = cellID.charAt(2);
log("openCell("+cellX+","+cellY+")");

                $("#"+cellID).removeClass("cell-close");
                $("#"+cellID).addClass("cell-open");
                /* if( matrix[cellX][cellY] == "X" )
                { gameOver(cellX,cellY); } // cell to highlight in red bg when game is over
                else
                { $("#"+cellID).text( matrix[cellX][cellY] ); } */
                $("#"+cellID).text( matrix[cellX][cellY] );
            }

        </script>
    </body>
</html>